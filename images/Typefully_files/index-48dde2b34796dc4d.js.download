(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8738:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(19114)}])},19114:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Y}});var r=n(52322),o=n(2732),i=n(57167),a=n(35588),u=n(93339);function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(c){u=!0,o=c}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var l=function(){var e=s((0,o.useRecoilState)(i.eo),2),t=e[0],n=e[1];return(0,r.jsx)(a.Z,{onClick:function(){return n(!t)},children:(0,r.jsx)(u.Z,{ml:"3px",className:"sidebar-button",name:"sidebarAlt"})})},f=n(94776),d=n.n(f),h=n(2850),v=n(83842),p=n(5632),y=n(2784),m=n(49857),b=n(69610),w=n(76656),g=n(57091),_=n(32488);function S(e,t,n,r,o,i,a){try{var u=e[i](a),c=u.value}catch(s){return void n(s)}u.done?t(c):Promise.resolve(c).then(r,o)}function k(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){S(i,r,o,a,u,"next",e)}function u(e){S(i,r,o,a,u,"throw",e)}a(void 0)}))}}function x(e){var t=(0,p.useRouter)(),n=t.query.new,r=(0,h.Pk)(),a=(0,o.useSetRecoilState)(i.Wr);(0,y.useEffect)((function(){r&&function(e,t,n){if(!e||0===e.length)return;if(E===e)return void console.log("catch duplicate thread text. returning");E=e,function(e){return j.apply(this,arguments)}({text:e,rich_text:C(e).content}).then((function(e){n.replace("/"),(0,m.JG)(_.y$),t(e)}))}(n,(function(t){a(t.id),null===e||void 0===e||e(t),b.ym.success("Draft created")}),t)}),[r,n])}var E=null;function j(){return(j=k(d().mark((function e(t){var n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,w.ZP.post("/threads/",t);case 3:return n=e.sent,e.abrupt("return",n.data);case 7:e.prev=7,e.t0=e.catch(0),(0,g.Z)(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function C(e){var t=e.split("\n").map((function(e){return e.length>0?{type:"paragraph",content:[{type:"text",text:e}]}:{type:"paragraph"}}));return{type:"doc",content:[{type:"tweet",attrs:v.R.getDefaultAttrs(),content:t}]}}var P=n(37494);var A=n(35231);var O=n(42854),Z=n(91301),T=n(10534),I=n(11221),N=n(66094);function L(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var R=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.subscribers=[],this.conf=t}var t,n,r;return t=e,r=[{key:"getInstance",value:function(){return e.instance||(e.instance=new e(e.instanceWSConf)),e.instance}}],(n=[{key:"subscribe",value:function(e,t){e&&(this.subscribers.push(t),this.channelValue&&this.channelValue===e||(this.close(),this.channelValue=e,this.open()))}},{key:"unsubscribe",value:function(e){this.subscribers=this.subscribers.filter((function(t){return t!=e}))}},{key:"reset",value:function(){this.channelValue=void 0,this.close()}},{key:"send",value:function(e){var t;null===(t=this.wsClient)||void 0===t||t.send(JSON.stringify(e))}},{key:"internalBroadcast",value:function(e){this.subscribers.forEach((function(t){t.onMessage(e)}))}},{key:"open",value:function(){var e=this,t=(0,w.is)();this.conf.path.search=new URLSearchParams(t).toString(),this.wsClient=new WebSocket(this.conf.path.toString()),this.wsClient.onopen=function(t){e.conf.initialHandshakeMsg&&e.send(e.conf.initialHandshakeMsg),e.subscribers.forEach((function(e){e.onOpen()}))},this.wsClient.onmessage=function(t){e.internalBroadcast(JSON.parse(t.data))},this.wsClient.onerror=function(t){e.subscribers.forEach((function(e){e.onError(t)}))},this.wsClient.onclose=function(t){e.subscribers.forEach((function(e){e.onClose(t)})),t.wasClean||1006===t.code||4242===t.code||(e.close(),e.open())}}},{key:"close",value:function(){var e;null===(e=this.wsClient)||void 0===e||e.close(4242)}}])&&L(t.prototype,n),r&&L(t,r),e}();function M(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function W(e,t,n,r,o,i,a){try{var u=e[i](a),c=u.value}catch(s){return void n(s)}u.done?t(c):Promise.resolve(c).then(r,o)}function D(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){W(i,r,o,a,u,"next",e)}function u(e){W(i,r,o,a,u,"throw",e)}a(void 0)}))}}function q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function U(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(c){u=!0,o=c}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return M(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return M(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function V(){var e=R.getInstance(),t=(0,y.useState)(!1),n=t[0],a=t[1],u=(0,h.aC)(),c=(0,h.mA)(),s=(0,o.useRecoilValue)(i.Wr),l=(0,T.Z)(s),f=(0,Z.Z)(),v=(0,o.useSetRecoilState)(i.b_),p=u.selectedAccount&&c&&void 0!==f,m=U((0,o.useRecoilState)(i.Q5),2),b=m[0],S=m[1],k=(0,y.useState)(!1),x=k[0],E=k[1],j=(0,y.useRef)((function(){})),C=(0,y.useCallback)((function(e,t){S((function(n){return new Map(n.set(e,t))}))}),[S]),P=(0,y.useCallback)((function(t){var n=t.session_id===(0,w.is)().Session;E(n);var r=t.thread_id;C(r,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){q(e,t,n[t])}))}return e}({},t.lock_owner,{ownerIsSelf:n,threadId:r}));var o=new Date(t.lock_expiration).getTime(),i=(new Date).getTime(),a=Math.max(0,o-i);j.current=function(e,t,n){clearTimeout(z[e]);var r=setTimeout(D(d().mark((function e(){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n();case 2:case"end":return e.stop()}}),e)}))),t);return z[e]=r,function(){clearTimeout(r)}}(r,a,D(d().mark((function t(){var n;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,w.ZP.get((0,_.lv)(r));case 3:n=t.sent.data,e.internalBroadcast(n),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),(0,g.Z)(t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])}))))}),[C,e]),A=(0,y.useMemo)((function(){return{onOpen:function(){a(!0)},onMessage:function(e){var t=e,n=(0,w.is)().Session===t.session_id;if("lock_statuses"===t.type){var r=!0,o=!1,i=void 0;try{for(var a,u=t.locks[Symbol.iterator]();!(r=(a=u.next()).done);r=!0){var c=a.value;P(c)}}catch(s){o=!0,i=s}finally{try{r||null==u.return||u.return()}finally{if(o)throw i}}}else if("draft_list_changed"===t.type){if(n)return;"delete"===t.event&&t.thread_id&&clearTimeout(z[t.thread_id])}else if("lock_acquired"===t.type){if(n)return;P(t)}else"lock_released"===t.type&&(j.current(),C(t.thread_id,null),!0===t.start_message||x||(0,I.h)("typefully:sync_draft_after_lock_release"));v(t)},onClose:function(e){a(!1)},onError:function(e){console.error(e)}}}),[P,x,v,C]);return(0,y.useEffect)((function(){if(p)return e.subscribe(c.id,A),function(){e.unsubscribe(A)};e.reset()}),[null===c||void 0===c?void 0:c.id,p,A,e]),(0,y.useEffect)((function(){var e=function(){for(var e in z)clearTimeout(z[e]),z[e]=null};return window.addEventListener("typefully:change_account",e),function(){window.removeEventListener("typefully:change_account",e)}}),[]),(0,y.useEffect)((function(){p&&s&&n&&(l&&l!==s&&e.send({type:"leave_thread",thread_id:l}),s&&l!==s&&e.send({type:"thread_status",thread_id:s}))}),[c,p,b,l,s,e,n]),(0,r.jsx)(r.Fragment,{})}R.instanceWSConf={path:new URL("".concat(N._4,"/ws/live/")),initialHandshakeMsg:{type:"subscribe_to_live_events"}};var z={},H=n(63241),B=n(43354),F=n(21346),J=n(56308),X=n(80312),Y=function(){!function(){var e=(0,h.aF)(),t=(0,h.mA)(),n=Intl.DateTimeFormat().resolvedOptions().timeZone,r=(0,A.Z)();(0,y.useEffect)((function(){if(n){if(e&&!e.timezone)try{var o=w.ZP.patch("/me/",{timezone:n});(0,h.vb)(o.data,!1)}catch(i){console.log(i)}if(t&&!t.timezone)try{w.ZP.patch((0,_.X1)(t.id),{timezone:n}),r("/accounts/**")}catch(i){console.log(i)}}}),[e,t,n,r])}(),function(){var e=function(){b.ym.success("You are back online")},t=function(){b.ym.error("You seem to be offline",{id:"network"})};(0,y.useEffect)((function(){return window.addEventListener("offline",t),window.addEventListener("online",e),function(){window.removeEventListener("offline",t),window.removeEventListener("online",e)}}),[])}();var e=(0,o.useSetRecoilState)(i.Wr);x((function(t){e(t.id)})),function(){var e=(0,p.useRouter)(),t=(0,h.Pk)(),n=(0,y.useState)(!1),r=n[0],a=n[1],u=(0,P.Z)().mutateThreadsList,c=(0,o.useSetRecoilState)(i.Wr),s=(0,h.aC)(),l=s.accounts,f=s.teamMemberships,d=s.updateSelectedAccountId;(0,y.useEffect)((function(){if(t&&l.length>0&&f.length>0&&"string"===typeof e.query.a&&"string"===typeof e.query.d){var n=parseInt(e.query.a),r=parseInt(e.query.d);if(!Number.isNaN(n)&&!Number.isNaN(r)){var o=l.find((function(e){return e.id===n})),i=f.find((function(e){return e.team.accounts.find((function(e){return e.id===n}))}));o||i?(a(!0),d(n),c(r),u("currently-selected-filter"),e.replace("/")):(b.ym.error("You don't have access to this account"),e.replace("/"),a(!1))}}}),[l,t,u,e,c,f,d]),(0,y.useEffect)((function(){var e=function(){r&&(b.ym.error("Team draft not found"),a(!1))};return window.addEventListener("typefully:thread_not_found",e),function(){window.removeEventListener("typefully:thread_not_found",e)}}),[r])}();var t=(0,b.fV)(),n=t.isPwa,a=t.browser,u=t.platform,c=(0,b.Gc)(H.Qw),s=(0,h.Pk)(),f=(0,y.useState)(!1),d=f[0],v=f[1];return(0,y.useEffect)((function(){if(s&&!d){var e=setTimeout((function(){(0,O.Z)("App Launch",{installed:n,browser:a,platform:u}),v(!0)}),3e3);return function(){return clearTimeout(e)}}}),[a,n,d,s,u]),(0,r.jsxs)(F.Z,{leftLinks:(0,r.jsx)(b.Ug,{gap:3,children:(0,r.jsx)(l,{})}),fixed:!c,fixedHeader:!0,style:c?{display:"flex",flexDirection:"column"}:{},children:[(0,r.jsx)(X.Z,{}),(0,r.jsxs)(b.Ug,{gap:0,vAlign:"stretch",w:"100%",overflow:"hidden",margin:"0 auto",noWrap:!0,style:{flex:1},children:[(0,r.jsx)(J.ZP,{}),(0,r.jsx)(H.ZP,{}),(0,r.jsx)(B.Z,{}),(0,r.jsx)(V,{})]})]})}}},function(e){e.O(0,[346,774,888,179],(function(){return t=8738,e(e.s=t);var t}));var t=e.O();_N_E=t}]);
//# sourceMappingURL=index-48dde2b34796dc4d.js.map